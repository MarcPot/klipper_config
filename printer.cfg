# |------------------------|
# |        BACKPACK        |
# |------------------------|
# | Y  |    | Z1 |    | X1 |
# |-----    ------    -----|
# |                        |
# | ------          ------ |
# | | Z  |          | Z2 | |
# | ------          ------ |
# |-----              -----|
# | X  |              | Y1 |
# |------------------------|

# MCU SPIDER
[mcu] 
serial = /dev/serial/by-id/usb-Klipper_stm32f446xx_3D0016000E50563046363120-if00
restart_method = command

[mcu rpi]
## Host Raspberry Pi as MCU for controlling GPIO
##--------------------------------------------------------------------
serial = /tmp/klipper_host_mcu
##--------------------------------------------------------------------

[include configs/*.cfg]

#virtual sdcard settings
[virtual_sdcard]
path = ~/gcode_files

#enable display status for moonraker
[display_status]

# Enable Pause/Resume Functionality
[pause_resume]

#Printer Speeds and Accels
[printer]
kinematics =             cartesian
max_velocity =           500
max_accel =              2000 #change this to 7500 after commissioning
max_z_velocity =         10   #may be able to increase to 15 after comissioning.
max_z_accel =            100
square_corner_velocity = 8.0

#Gcode G2/G3 Arc Support
[gcode_arcs]
resolution = 0.1

#Input Shaper Settings
# you need to tune your printer for this
# [input_shaper]
# shaper_freq_x =
# shaper_freq_y =
# shaper_type = mzv

# Force Move
#	used to force a single stepper to move.  not used once setup
[force_move]
enable_force_move = true

# Dockable Probe
[dockable_probe]
# connected to E1 (Y-Max Port) Endstop on SPIDER
pin =                       ^PA2
x_offset =                  -25.0 # offset for microswitch x direction off nozzle
y_offset =                  -1.88 # offset for microswitch y direction off nozzle
z_offset =                  2 # offset for microswitch in z height - this is a starting point only
samples =                   3
sample_retract_dist =       5
samples_result =            median
samples_tolerance =         0.02
samples_tolerance_retries = 3
speed =                     3
lift_speed =                15

# annexed probe specific
dock_position =             -8,181,20 #back left corner of gantry
approach_position =         32,181,20
detach_position =           -8,141,20
safe_z_position =           90,90 #center of bed
attach_speed =              20
detach_speed =              100
travel_speed =              300
check_open_attach =         True
probe_sense_pin =           ^PA3
dock_fixed_z =              True
dock_retries =			    1

#   Optional custom gcode sections for annexed probe
pre_attach_gcode =
    G1 X40 Y40 F18000    #keep umbilical from catching on stuff
pre_detach_gcode =
    G1 X40 Y40 F18000   #keep umbilical from catching on stuff




# Mesh Bed Settings
[bed_mesh]
speed =                    200
horizontal_move_z =        20.0
mesh_min =                 20,25
mesh_max =                 150, 155
probe_count =              5,5
fade_start =               0.5
fade_end =                 2
split_delta_z =            .025
move_check_distance =      5.0
mesh_pps =                 2,2
algorithm =                bicubic
bicubic_tension =          0.1
relative_reference_index = 12  # ^^^because were measuring the offset from the nozzle switch to the bed using the center of the bed, the equation to find the location = (probe point count)/2-1

# Z Tilt Bed Adjustment settings
[z_tilt]
#3 Z Motors
z_positions = 
    -74.0, -18.0    # Front Left
    76.0,  217.0    # Rear
    226.0, -18.0    # Front Right
points =
    45, 25          # Front Left
    101, 160        # Rear
    175, 25         # Front Right
speed =             200
horizontal_move_z = 20.0
retries =           4
retry_tolerance =   0.01


# Motor and Heater Idle Timeout
[idle_timeout]
timeout = 6000
