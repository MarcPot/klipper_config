## Filament loading/unloading macro's
##--------------------------------------------------------------------
[gcode_macro LOAD_FILAMENT]
default_parameter_E = 80
gcode =
  {% if printer.extruder.temperature >= 170 %}
    M117 "Loading..."
    M83
    G1 E{E|int/3*2} F300
    G1 E{E|int/3} F150
    M82
    M117 "Finished loading."
  {% else %}
    M117 "Load disabled with temperature lower than 170C!"
  {%endif %}
  UPDATE_DELAYED_GCODE ID=CLEAR_DISP DURATION=10

[gcode_macro UNLOAD_FILAMENT]
default_parameter_DISTANCE = 90
gcode =
  {% if printer.extruder.temperature >= 170 %}
  M117 "Unloading."
    M83
    G1 E10 F300
    G1 E{DISTANCE|int * -1} F2000
    M82
    M117 "Finished unloading."
  {% else %}
    M117 "Unload disabled with temperature lower than 170C!"
  {%endif %}
  UPDATE_DELAYED_GCODE ID=CLEAR_DISP DURATION=10
##--------------------------------------------------------------------	

## In print macro's. Pause/resume/cancel filament runout etc.
##--------------------------------------------------------------------
[gcode_macro CANCEL_PRINT]
rename_existing =     BASE_CANCEL_PRINT
default_parameter_X = 230
default_parameter_Y = 230
default_parameter_Z = 10
gcode =
  M104 S0
  M140 S0
  M141 S0
  M106 S0
  CLEAR_PAUSE
  SDCARD_RESET_FILE
  BASE_CANCEL_PRINT

[gcode_macro PAUSE]
rename_existing =     BASE_PAUSE
default_parameter_X = 230
default_parameter_Y = 230
default_parameter_Z = 10
default_parameter_E = 1
gcode =
  SAVE_GCODE_STATE NAME=PAUSE_state
  BASE_PAUSE
  G91
  G1 E-{E} F2100
  G1 Z{Z}
  G90
  G1 X{X} Y{Y} F6000

[gcode_macro RESUME]
rename_existing =     BASE_RESUME
default_parameter_E = 1
gcode =
  G91
  G1 E{E} F2100
  G90
  RESTORE_GCODE_STATE NAME=PAUSE_state MOVE=1
  BASE_RESUME
	
[gcode_macro M600]
default_parameter_X = 50
default_parameter_Y = 10
default_parameter_Z = 20
gcode =
  PAUSE X={X} Y={Y} Z={Z}
  UNLOAD_FILAMENT
##--------------------------------------------------------------------